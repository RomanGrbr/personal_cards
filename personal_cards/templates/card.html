{% extends "base.html" %}
{% block title %}
  Персональные карточки
{% endblock %}
{% block content %}

  {% with data=form.initial %}

  {% if '/edit/' in request.path %}
    <h3>Редактировать {{ data.id }}</h3>
  {% elif "/delete/" in request.path %}
      <h1>Удалить запись {{ data.id }}</h1>
  {% else %}
    <h1>Создать запись</h1>
  {% endif %}

  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ formset.management_form }}
    <table>
        {% if not "/delete/" in request.path %}

          {% for field in form %}
            <tr>
              <td>
                {{ field.label }} {{ field }}
                  {% if field.name != "name" and field.name != "last_name" %}
                    <button type="button" onclick="addNewElement(this)">+</button><button type="button" onclick="delElement(this)">-</button>
                  {% endif %}
                {% endfor %}
              </td>
            </tr>
            {% for file in files %}
              <p>Ссылка: <a href="{{ file }}">{{ file }}</a></p>
              <img src="{{ file }}" width="100px">
            {% endfor %}

        {% else %}

          {% for field in form %}
              {% if field.field.widget.attrs.attr_type == 'ImageField' %}
                <a href="{{ file.initial }}">
                  <img src="{{ field.initial }}" width="100px">
                </a>
              {% else %}
                <b>{{ field.label }}:</b> {{ field.initial }}<br>
            {% endif %}
          {% endfor %}
        {% endif %}
    </table>
    {% if '/edit/' in request.path %}
      <input type="submit" value="Сохранить изменения" class="btn btn-primary">
    {% elif "/delete/" in request.path %}
       <input type="submit" value="Удалить запись" class="btn btn-primary">
    {% else %}
     <input type="submit" value="Создать запись" class="btn btn-primary">
    {% endif %}
  </form>

  {% if form.is_valid %}
    {% if '/edit/' in request.path %}
      <h3>Запись отредактирована</h3>
    {% else %}
      <h3>Запись сохранена: {{ data.id }}</h3>
    {% endif %}
  {% endif %}

  {% endwith %}
{% endblock %}